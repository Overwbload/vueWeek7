import{_ as g,o as n,c as i,a as t,F as $,g as w,t as P,i as u,v as m,p as N,d as y,e as D,s as V,j as S,k as v,m as x,f as E,h as O,r as p,b as h}from"./index-Bs_37LNX.js";import{P as L}from"./PaginationComponent-BHPV1Bxf.js";import{M as I}from"./modal-DaxTTC6D.js";import{L as T}from"./LoadingOverlay-BaGJTY_t.js";const B={data(){return{}},methods:{openModal(e){this.$emit("openNewModal",e)}}};function R(e,o,a,r,l,d){return n(),i("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=s=>d.openModal("new"))}," 建立新的產品 ")}const J=g(B,[["render",R]]),F={props:["products"],data(){return{}},methods:{openModal(e,o){this.$emit("openCreatedModal",e,o)}}},j={class:"table mt-4"},H=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),W={class:"text-start"},q={class:"text-start"},z={key:0,class:"text-success"},G={key:1},K={class:"btn-group"},Q=["onClick"],X=["onClick"];function Y(e,o,a,r,l,d){return n(),i("table",j,[H,t("tbody",null,[(n(!0),i($,null,w(a.products,s=>(n(),i("tr",{key:s.id},[t("td",null,P(s.category),1),t("td",null,P(s.title),1),t("td",W,P(s.origin_price),1),t("td",q,P(s.price),1),t("td",null,[s.is_enabled===1?(n(),i("span",z,"啟用")):(n(),i("span",G,"未啟用"))]),t("td",null,[t("div",K,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:c=>d.openModal("edit",s)},"編輯",8,Q),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:c=>d.openModal("delete",s)},"刪除",8,X)])])]))),128))])])}const Z=g(F,[["render",Y]]),tt={props:["tempProduct"],data(){return{localProduct:{...this.tempProduct},bsModal:"",loadingIcon:""}},methods:{confirmProduct(){this.$emit("confirm")},createImages(){this.$emit("createImg")},delImages(e){this.$emit("delImg",e)},openModal(){this.bsModal.show()},closeModal(){this.bsModal.hide()},upload(){const e=this.$refs.fileInput.files[0];this.$emit("uploadImg",e)},uploadApi(){this.loadingIcon=!0,this.$refs.fileInput.files[0]===void 0&&(this.loadingIcon=!1),this.$emit("callUploadApi"),this.$refs.fileInput.value=""}},mounted(){this.bsModal=new I(this.$refs.productModal)},watch:{tempProduct:{handler(e){this.loadingIcon=!1,this.localProduct=e},deep:!0}}},ot={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},et={class:"modal-dialog modal-xl"},st={class:"modal-content border-0"},lt={class:"modal-header bg-dark text-white"},dt={id:"productModalLabel",class:"modal-title"},at={key:0},nt={key:1},it=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),rt={class:"modal-body"},ct={class:"row"},ut={class:"col-sm-4"},mt={class:"mb-2"},pt={class:"mb-3"},ht=t("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),_t={key:0,class:"fas fa-spinner fa-pulse p-2"},ft=["src"],bt=["for"],Pt=["id","onUpdate:modelValue"],gt=["src"],Mt=["onClick"],vt={class:"col-sm-8"},yt={class:"mb-3"},$t=t("label",{for:"title",class:"form-label"},"標題",-1),wt={class:"row"},It={class:"mb-3 col-md-6"},Ut=t("label",{for:"category",class:"form-label"},"分類",-1),Ct={class:"mb-3 col-md-6"},kt=t("label",{for:"unit",class:"form-label"},"單位",-1),At={class:"row"},Nt={class:"mb-3 col-md-6"},Dt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),Vt={class:"mb-3 col-md-6"},St=t("label",{for:"price",class:"form-label"},"售價",-1),xt=t("hr",null,null,-1),Et={class:"mb-3"},Ot=t("label",{for:"description",class:"form-label"},"產品描述",-1),Lt={class:"mb-3"},Tt=t("label",{for:"content",class:"form-label"},"說明內容",-1),Bt={class:"mb-3"},Rt={class:"form-check"},Jt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Ft={class:"modal-footer"},jt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1);function Ht(e,o,a,r,l,d){return n(),i("div",ot,[t("div",et,[t("div",st,[t("div",lt,[t("h5",dt,[a.tempProduct.id?(n(),i("span",nt,"編輯產品")):(n(),i("span",at,"新增產品"))]),it]),t("div",rt,[t("div",ct,[t("div",ut,[t("div",mt,[t("div",pt,[ht,u(t("input",{id:"imageUrl",type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":o[0]||(o[0]=s=>l.localProduct.imageUrl=s)},null,512),[[m,l.localProduct.imageUrl]]),t("form",null,[t("input",{type:"file",class:"form-control my-2",id:"file",placeholder:"請選擇要上傳的圖片",onChange:o[1]||(o[1]=(...s)=>d.upload&&d.upload(...s)),ref:"fileInput"},null,544),t("button",{type:"submit",onClick:o[2]||(o[2]=N((...s)=>d.uploadApi&&d.uploadApi(...s),["prevent"]))},[y(" Upload"),l.loadingIcon?(n(),i("i",_t)):D("",!0)])])]),t("img",{class:"img-fluid",src:l.localProduct.imageUrl,alt:""},null,8,ft),(n(!0),i($,null,w(l.localProduct.imagesUrl,(s,c)=>(n(),i("span",{key:c},[t("label",{for:"imagesUrl"+c,class:"form-label mx-4"},"輸入圖片網址",8,bt),u(t("input",{id:"imagesUrl"+c,type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":M=>l.localProduct.imagesUrl[c]=M},null,8,Pt),[[m,l.localProduct.imagesUrl[c]]]),t("img",{src:s,alt:"",class:"img-fluid my-2"},null,8,gt),t("div",null,[t("button",{class:"btn btn-outline-danger btn-sm d-block my-2 w-100",onClick:M=>d.delImages(c)},"刪除圖片",8,Mt)])]))),128)),t("div",null,[t("button",{class:"btn btn-outline-primary btn-sm d-block my-2 w-100",onClick:o[3]||(o[3]=(...s)=>d.createImages&&d.createImages(...s))},"新增更多圖片")])])]),t("div",vt,[t("div",yt,[$t,u(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":o[4]||(o[4]=s=>l.localProduct.title=s)},null,512),[[m,l.localProduct.title]])]),t("div",wt,[t("div",It,[Ut,u(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":o[5]||(o[5]=s=>l.localProduct.category=s)},null,512),[[m,l.localProduct.category]])]),t("div",Ct,[kt,u(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":o[6]||(o[6]=s=>l.localProduct.unit=s)},null,512),[[m,l.localProduct.unit]])])]),t("div",At,[t("div",Nt,[Dt,u(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":o[7]||(o[7]=s=>l.localProduct.origin_price=s)},null,512),[[m,l.localProduct.origin_price,void 0,{number:!0}]])]),t("div",Vt,[St,u(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":o[8]||(o[8]=s=>l.localProduct.price=s)},null,512),[[m,l.localProduct.price,void 0,{number:!0}]])])]),xt,t("div",Et,[Ot,u(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":o[9]||(o[9]=s=>l.localProduct.description=s)},`\r
                    `,512),[[m,l.localProduct.description]])]),t("div",Lt,[Tt,u(t("textarea",{id:"content",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":o[10]||(o[10]=s=>l.localProduct.content=s)},`\r
                    `,512),[[m,l.localProduct.content]])]),t("div",Bt,[t("div",Rt,[u(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[11]||(o[11]=s=>l.localProduct.is_enabled=s)},null,512),[[V,l.localProduct.is_enabled]]),Jt])])])])]),t("div",Ft,[jt,t("button",{type:"button",class:"btn btn-primary",onClick:o[12]||(o[12]=(...s)=>d.confirmProduct&&d.confirmProduct(...s))},"確認")])])])],512)}const Wt=g(tt,[["render",Ht]]),qt={props:["tempProduct"],data(){return{delModal:""}},methods:{confirmDel(){this.$emit("delProduct")},delModalShow(){this.delModal.show()},delModalHide(){this.delModal.hide()}},mounted(){this.delModal=new I(this.$refs.delProductModal)}},zt={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},Gt={class:"modal-dialog"},Kt={class:"modal-content border-0"},Qt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Xt={class:"modal-body"},Yt={class:"text-danger"},Zt={class:"modal-footer"},to=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1);function oo(e,o,a,r,l,d){return n(),i("div",zt,[t("div",Gt,[t("div",Kt,[Qt,t("div",Xt,[y(" 是否刪除"),t("strong",Yt,"【"+P(this.tempProduct.title)+"】",1),y(" 商品(刪除後將無法恢復)。 ")]),t("div",Zt,[to,t("button",{type:"button",class:"btn btn-danger",onClick:o[0]||(o[0]=(...s)=>d.confirmDel&&d.confirmDel(...s))},"確認刪除")])])])],512)}const eo=g(qt,[["render",oo]]),so={BASE_URL:"/vueWeek7/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_API_NAME:"jasonfu-api-vuetest",VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2"},{VITE_APP_API_URL:_,VITE_APP_API_NAME:f}=so,b=S("adminProducts",{state:()=>({tempProduct:{},products:[],isNew:"",pagination:{},formData:"",loadingStatus:""}),actions:{renderProducts(e=1){const o=`${_}/api/${f}/admin/products?page=${e}`;v.get(o).then(a=>{this.loadingStatus=!1,this.products=a.data.products,this.pagination=a.data.pagination}).catch(a=>{alert(a.response.data.message)})},openModal(e,o){this.isNew=e,e==="new"?this.tempProduct={imagesUrl:[]}:e==="edit"?this.tempProduct=JSON.parse(JSON.stringify(o)):e==="delete"&&(this.tempProduct={...o})},checkImagesArray(){this.tempProduct.imagesUrl&&(this.tempProduct.imagesUrl=this.tempProduct.imagesUrl.filter(e=>e!==""))},confirmProduct(){const e=!this.tempProduct.id,o=e?`${_}/api/${f}/admin/product`:`${_}/api/${f}/admin/product/${this.tempProduct.id}`,a=e?"post":"put";if(this.checkImagesArray(),!e){const r=this.products.find(l=>l.id===this.tempProduct.id);if(r&&JSON.stringify(r)===JSON.stringify(this.tempProduct)){alert("No changes made!!");return}}v[a](o,{data:this.tempProduct}).then(r=>{console.log(this.tempProduct),this.renderProducts(),this.isNew="closeModal",alert(r.data.message)}).catch(r=>{alert(r.response.data.message)})},confirmDel(){if(this.products.find(o=>o.id===this.tempProduct.id)){const o=`${_}/api/${f}/admin/product/${this.tempProduct.id}`;v.delete(o).then(a=>{this.renderProducts(),this.isNew="closeModal",alert(a.data.message)}).catch(a=>{alert(a.response.data.message)})}},createImages(){this.tempProduct.imagesUrl||(this.tempProduct.imagesUrl=[]),this.tempProduct.imagesUrl.push("")},delImages(e){this.tempProduct.imagesUrl.splice(e,1)},upload(e){this.formData=new FormData,this.formData.append("file-to-upload",e)},uploadApi(){if(!this.formData){alert("No file to upload");return}const e=`${_}/api/${f}/admin/upload`;v.post(e,this.formData).then(o=>{alert("上傳成功"),this.tempProduct.imageUrl=o.data.imageUrl,this.formData=""}).catch(o=>{alert(o.response.data.message)})}}}),lo={computed:{...x(b,["products","tempProduct","isNew","pagination","formData","loadingStatus"])},components:{NewProductBtn:J,Pagination:L,AdminProductTable:Z,ProductModal:Wt,DelProductModal:eo,LoadingOverlay:T},data(){return{}},methods:{...E(b,["renderProducts","openModal","checkImagesArray","confirmProduct","confirmDel","createImages","delImages","upload","uploadApi"])},mounted(){this.renderProducts(),O(()=>{this.isNew==="new"||this.isNew==="edit"?(b().isNew="",this.$refs.productModalComponent.openModal(),this.$refs.productModalComponent.$refs.fileInput.value=""):this.isNew==="delete"?(b().isNew="",this.$refs.delProductModalComponent.delModalShow()):this.isNew==="closeModal"&&(b().isNew="",this.$refs.productModalComponent.closeModal(),this.$refs.delProductModalComponent.delModalHide())})}},ao={class:"container"},no={class:"text-end mt-4"};function io(e,o,a,r,l,d){const s=p("LoadingOverlay"),c=p("NewProductBtn"),M=p("AdminProductTable"),U=p("Pagination"),C=p("ProductModal"),k=p("DelProductModal");return n(),i($,null,[t("div",ao,[h(s,{active:e.loadingStatus,"onUpdate:active":o[0]||(o[0]=A=>e.loadingStatus=A),"is-full-page":!0},null,8,["active"]),t("div",no,[h(c,{onOpenNewModal:e.openModal},null,8,["onOpenNewModal"])]),h(M,{products:e.products,onOpenCreatedModal:e.openModal},null,8,["products","onOpenCreatedModal"]),h(U,{pages:e.pagination,onEmitPages:e.renderProducts},null,8,["pages","onEmitPages"])]),h(C,{ref:"productModalComponent","temp-product":e.tempProduct,onConfirm:e.confirmProduct,onCreateImg:e.createImages,onDelImg:e.delImages,onUploadImg:e.upload,onCallUploadApi:e.uploadApi},null,8,["temp-product","onConfirm","onCreateImg","onDelImg","onUploadImg","onCallUploadApi"]),h(k,{ref:"delProductModalComponent","temp-product":e.tempProduct,onDelProduct:e.confirmDel},null,8,["temp-product","onDelProduct"])],64)}const po=g(lo,[["render",io]]);export{po as default};
