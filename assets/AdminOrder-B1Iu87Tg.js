import{L as A}from"./LoadingOverlay-BPLoJJX8.js";import{P as w}from"./PaginationComponent-BCYel7q5.js";import{j as I,k as b,u as N,m as y,f as P,_ as k,o as r,c as l,a as e,t as o,e as g,F as M,g as v,i as V,v as T,d as f,h as R,r as p,b as h}from"./index-Bvi3KzUi.js";import{M as S}from"./modal-BacIT41F.js";const U={BASE_URL:"/vueWeek7/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_API_NAME:"jasonfu-api-vuetest",VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2"},{VITE_APP_API_URL:O,VITE_APP_API_NAME:$}=U,i=I("orderStore",{state:()=>({orders:[],pagination:{},loadingStatus:"",tempOrder:{},status:"",currentPage:""}),actions:{getOrder(t=1){this.currentPage=t;const s=`${O}/api/${$}/admin/orders?page=${t}`;b.get(s).then(d=>{this.loadingStatus=!1,this.orders=d.data.orders,this.pagination=d.data.pagination}).catch(d=>{alert(d.message)})},openModal(t,s){this.status=t,t==="edit"?this.tempOrder=JSON.parse(JSON.stringify(s)):t==="delete"&&(this.tempOrder=JSON.parse(JSON.stringify(s)))},paid(t){this.tempOrder.order.is_paid=!0},confirmOrder(){const t=`${O}/api/${$}/admin/order/${this.tempOrder.order.id}`;b.put(t,{data:this.tempOrder.order}).then(s=>{this.getOrder(this.currentPage),this.status="closeModal",alert(s.data.message)}).catch(s=>{alert(s.response.data.message)})},confirmDel(){if(this.orders.find(s=>s.id===this.tempOrder.order.id)){const s=`${O}/api/${$}/admin/order/${this.tempOrder.order.id}`;b.delete(s).then(d=>{this.getOrder(this.currentPage),this.status="closeModal",alert(d.data.message)}).catch(d=>{console.dir(d)})}}},getters:{orderList:({orders:t})=>({newOrders:t.map(d=>{const c=N.unix(d.create_at).format("YYYY/MM/DD HH:mm:ss");return{order:d,time:c}})})}}),B={computed:{...y(i,["tempOrder"])},data(){return{bsModal:"",loadingIcon:""}},methods:{...P(i,["paid"]),confirmOrder(){this.$emit("confirm")},openModal(){this.bsModal.show()},closeModal(){this.bsModal.hide()}},mounted(){this.bsModal=new S(this.$refs.orderModal)}},H={id:"orderModal",ref:"orderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},J={class:"modal-dialog modal-xl"},Y={class:"modal-content border-0"},j=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{id:"orderModalLabel",class:"modal-title"},[e("span",null,"編輯訂單")]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),q={key:0,class:"modal-body"},F={class:"row"},W={class:"col-sm-6"},z={class:"mb-2"},G=e("label",{class:"form-label"},"訂單編號：",-1),K={class:"mb-2"},Q=e("label",{class:"form-label"},"建立時間：",-1),X={class:"mb-2"},Z=e("label",{class:"form-label"},"總金額：",-1),x={class:"mb-2"},ee=e("label",{class:"form-label"},"付款狀態：",-1),te=["disabled"],se=["disabled"],oe={key:0,class:"text-success"},de=e("hr",null,null,-1),re={class:"userInfo"},le={class:"mb-2"},ae=e("label",{class:"form-label"},"姓名：",-1),ne={class:"mb-2"},ie=e("label",{class:"form-label"},"電話：",-1),ce={class:"mb-2"},me=e("label",{class:"form-label"},"E-mail：",-1),ue={class:"mb-2"},pe=e("label",{class:"form-label"},"地址：",-1),he={class:"mb-2"},_e=e("label",{class:"form-label"},"留言：",-1),be={class:"col-sm-6"},fe={class:"table"},Oe=e("thead",null,[e("tr",null,[e("h5",null,"購買項目")])],-1),$e={class:"text-end"},ge=e("hr",null,null,-1),Me={class:"mb-3"},ve=e("label",{for:"description",class:"form-label"},"備註",-1),ye={class:"modal-footer"},Pe=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1);function ke(t,s,d,c,C,m){return r(),l("div",H,[e("div",J,[e("div",Y,[j,t.tempOrder.order?(r(),l("div",q,[e("div",F,[e("div",W,[e("div",z,[G,e("span",null,o(t.tempOrder.order.id),1)]),e("div",K,[Q,e("span",null,o(t.tempOrder.time),1)]),e("div",X,[Z,e("span",null,o(t.$filters.currency(t.tempOrder.order.total)),1)]),e("div",x,[ee,e("button",{type:"button",class:"btn btn-outline-danger me-2",disabled:!t.tempOrder.order.is_paid},"未付款",8,te),e("button",{type:"button",class:"btn btn-outline-success",disabled:t.tempOrder.order.is_paid,onClick:s[0]||(s[0]=a=>t.paid(t.tempOrder.order))},"已付款",8,se),t.tempOrder.order.is_paid?(r(),l("span",oe," - 2024/08/20 18:33:09")):g("",!0)]),de,e("div",re,[e("div",le,[ae,e("span",null,o(t.tempOrder.order.user.name),1)]),e("div",ne,[ie,e("span",null,o(t.tempOrder.order.user.tel),1)]),e("div",ce,[me,e("span",null,o(t.tempOrder.order.user.email),1)]),e("div",ue,[pe,e("span",null,o(t.tempOrder.order.user.address),1)]),e("div",he,[_e,e("span",null,o(t.tempOrder.order.message),1)])])]),e("div",be,[e("table",fe,[Oe,e("tbody",null,[(r(!0),l(M,null,v(t.tempOrder.order.products,(a,_)=>(r(),l("tr",{key:_},[e("th",null,o(a.product.title),1),e("td",null,o(a.qty)+" / "+o(a.product.unit),1),e("td",$e,o(t.$filters.currency(a.final_total)),1)]))),128))])]),ge,e("div",Me,[ve,V(e("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入備註內容","onUpdate:modelValue":s[1]||(s[1]=a=>t.tempOrder.order.note=a)},null,512),[[T,t.tempOrder.order.note]])])])])])):g("",!0),e("div",ye,[Pe,e("button",{type:"button",class:"btn btn-primary",onClick:s[2]||(s[2]=(...a)=>m.confirmOrder&&m.confirmOrder(...a))},"確認")])])])],512)}const Ce=k(B,[["render",ke]]),Se={computed:{...y(i,["tempOrder"])},data(){return{delModal:""}},methods:{...P(i,["confirmDel"]),delModalShow(){this.delModal.show()},delModalHide(){this.delModal.hide()}},mounted(){this.delModal=new S(this.$refs.delOrderModal)}},Le={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delOrderModalLabel","aria-hidden":"true"},De={class:"modal-dialog"},Ee={class:"modal-content border-0"},Ae=e("div",{class:"modal-header bg-danger text-white"},[e("h5",{id:"delOrderModalLabel",class:"modal-title"},[e("span",null,"刪除訂單")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),we={key:0,class:"modal-body"},Ie={class:"text-danger"},Ne=e("br",null,null,-1),Ve={class:"modal-footer"},Te=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1);function Re(t,s,d,c,C,m){return r(),l("div",Le,[e("div",De,[e("div",Ee,[Ae,t.tempOrder.order?(r(),l("div",we,[f(" 是否刪除"),e("strong",Ie,"【"+o(t.tempOrder.order.id)+"】",1),f(" 訂單 "),Ne,f(" (刪除後將無法恢復)。 ")])):g("",!0),e("div",Ve,[Te,e("button",{type:"button",class:"btn btn-danger",onClick:s[0]||(s[0]=(...a)=>t.confirmDel&&t.confirmDel(...a))},"確認刪除")])])])],512)}const Ue=k(Se,[["render",Re]]),Be={computed:{...y(i,["pagination","orderList","loadingStatus","status","orders"])},components:{PaginationComponent:w,LoadingOverlay:A,OrderModal:Ce,DelOrderModal:Ue},data(){return{}},methods:{...P(i,["getOrder","openModal","confirmOrder"])},mounted(){this.getOrder(),R(()=>{this.status==="edit"?(i().status="",this.$refs.orderModalComponent.openModal()):this.status==="delete"?(i().status="",this.$refs.delOrderModal.delModalShow()):this.status==="closeModal"&&(i().status="",this.$refs.orderModalComponent.closeModal(),this.$refs.delOrderModal.delModalHide())})}},He={class:"container"},Je=e("h2",{class:"ms-1 mt-2"},"訂單列表",-1),Ye={class:"table table-striped"},je=e("thead",null,[e("tr",null,[e("th",null,"訂單編號"),e("th",null,"購買時間"),e("th",null,"購買項目"),e("th",null,"應付金額"),e("th",null,"付款狀態"),e("th",null,"編輯")])],-1),qe={style:{width:"250px"}},Fe={style:{width:"250px"}},We={key:0,class:"text-success"},ze={key:1,class:"text-danger"},Ge={class:"btn-group"},Ke=["onClick"],Qe=["onClick"];function Xe(t,s,d,c,C,m){const a=p("LoadingOverlay"),_=p("PaginationComponent"),L=p("OrderModal"),D=p("DelOrderModal");return r(),l("div",He,[h(a,{active:t.loadingStatus,"onUpdate:active":s[0]||(s[0]=n=>t.loadingStatus=n),"is-full-page":!0},null,8,["active"]),Je,e("table",Ye,[je,e("tbody",null,[(r(!0),l(M,null,v(t.orderList.newOrders,n=>(r(),l("tr",{key:n.order.id},[e("td",qe,o(n.order.id),1),e("td",Fe,o(n.time),1),e("td",null,[e("ul",null,[(r(!0),l(M,null,v(n.order.products,(u,E)=>(r(),l("li",{key:E},o(u.product.title)+" 〔"+o(u.qty)+"〕 ",1))),128))])]),e("td",null,"$ "+o(t.$filters.currency(n.order.total)),1),e("td",null,[n.order.is_paid?(r(),l("span",We,"已付款")):(r(),l("span",ze,"未付款"))]),e("td",null,[e("div",Ge,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:u=>t.openModal("edit",n)},"編輯",8,Ke),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:u=>t.openModal("delete",n)},"刪除",8,Qe)])])]))),128))])]),h(_,{nationComponent:"",pages:t.pagination,onEmitPages:t.getOrder},null,8,["pages","onEmitPages"]),h(L,{ref:"orderModalComponent",onConfirm:t.confirmOrder},null,8,["onConfirm"]),h(D,{ref:"delOrderModal"},null,512)])}const st=k(Be,[["render",Xe]]);export{st as default};
