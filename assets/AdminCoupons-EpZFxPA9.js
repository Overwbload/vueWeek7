import{L as I}from"./LoadingOverlay-BaGJTY_t.js";import{P as A}from"./PaginationComponent-BHPV1Bxf.js";import{j as E,k as f,u as L,m as y,f as k,_ as M,o as d,c as i,a as o,i as c,v as C,s as P,d as v,t as h,h as Y,r as g,b as $,F as U,g as N,e as j}from"./index-Bs_37LNX.js";import{M as D}from"./modal-DaxTTC6D.js";const O={BASE_URL:"/vueWeek7/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_API_NAME:"jasonfu-api-vuetest",VITE_APP_API_URL:"https://ec-course-api.hexschool.io/v2"},{VITE_APP_API_URL:r,VITE_APP_API_NAME:m}=O,u=E("couponStore",{state:()=>({coupons:[],pagination:{},loadingStatus:"",loadingIcon:"",tempCoupon:{},status:"",currentPage:""}),actions:{getCoupon(t=1){this.currentPage=t;const e=`${r}/api/${m}/admin/coupons?page=${t}`;f.get(e).then(n=>{this.loadingStatus=!1,this.coupons=n.data.coupons,this.pagination=n.data.pagination}).catch(n=>{this.loadingStatus=!1,alert(n.message)})},openModal(t,e){this.status=t,t==="new"?this.tempCoupon={is_enabled:1,due_date:L().unix()}:this.tempCoupon={...e}},confirmCoupon(){const t=!this.tempCoupon.id,e=t?`${r}/api/${m}/admin/coupon`:`${r}/api/${m}/admin/coupon/${this.tempCoupon.id}`,n=t?"post":"put";if(!t){const l=this.coupons.find(_=>_.id===this.tempCoupon.id);if(l&&JSON.stringify(l)===JSON.stringify(this.tempCoupon)){alert("No changes made!!");return}}f[n](e,{data:this.tempCoupon}).then(l=>{this.getCoupon(this.currentPage),this.status="closeModal",alert(l.data.message)}).catch(l=>{alert(l.response.data.message)})},enabled(t){this.loadingIcon=t.id;const e=`${r}/api/${m}/admin/coupon/${t.id}`;f.put(e,{data:t}).then(n=>{this.loadingIcon="",this.getCoupon(this.currentPage),alert(n.data.message)}).catch(n=>{alert(n.response.data.message)})},confirmDel(){if(this.coupons.find(e=>e.id===this.tempCoupon.id)){const e=`${r}/api/${m}/admin/coupon/${this.tempCoupon.id}`;f.delete(e).then(n=>{this.getCoupon(this.currentPage),this.status="closeModal",alert(n.data.message)}).catch(n=>{alert(n.response.data.message)})}}}}),T={computed:{...y(u,["tempCoupon"]),temp_due_date:{get(){return this.tempCoupon.due_date?this.$dayjs.unix(this.tempCoupon.due_date).format("YYYY-MM-DD"):this.$dayjs().format("YYYY-MM-DD")},set(t){this.tempCoupon.due_date=this.$dayjs(t).unix()}}},data(){return{bsModal:"",loadingIcon:""}},methods:{...k(u,["confirmCoupon"]),openModal(){this.bsModal.show()},closeModal(){this.bsModal.hide()}},mounted(){this.bsModal=new D(this.$refs.couponModal)}},R={id:"couponModal",ref:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},B={class:"modal-dialog modal-md"},x={class:"modal-content border-0"},F=o("div",{class:"modal-header bg-dark text-white"},[o("h5",{id:"couponModalLabel",class:"modal-title"},[o("span",null,"新增優惠券")]),o("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),H={class:"modal-body"},J={class:"row"},W={class:""},q={class:"mb-3"},z=o("label",{for:"title",class:"form-label"},"標題",-1),G={class:"mb-3"},K=o("label",{for:"code",class:"form-label"},"優惠碼",-1),Q={class:"mb-3"},X=o("label",{for:"due_date",class:"form-label"},"到期日",-1),Z={class:"mb-3"},oo=o("label",{for:"percent",class:"form-label"},"折扣百分比",-1),to={class:"input-group"},eo=o("span",{class:"input-group-text"},"%",-1),so={class:"mb-3"},no={class:"form-check"},ao=o("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),lo={class:"modal-footer"},io=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1);function uo(t,e,n,l,_,p){return d(),i("div",R,[o("div",B,[o("div",x,[F,o("div",H,[o("div",J,[o("div",W,[o("div",q,[z,c(o("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[0]||(e[0]=a=>t.tempCoupon.title=a)},null,512),[[C,t.tempCoupon.title]])]),o("div",G,[K,c(o("input",{id:"code",type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":e[1]||(e[1]=a=>t.tempCoupon.code=a)},null,512),[[C,t.tempCoupon.code]])]),o("div",Q,[X,c(o("input",{id:"due_date",type:"date",class:"form-control",placeholder:"請輸入折扣百分比","onUpdate:modelValue":e[2]||(e[2]=a=>p.temp_due_date=a)},null,512),[[C,p.temp_due_date]])]),o("div",Z,[oo,o("div",to,[c(o("input",{id:"percent",type:"number",class:"form-control",placeholder:"請輸入折扣百分比 ex: 90",min:"0","onUpdate:modelValue":e[3]||(e[3]=a=>t.tempCoupon.percent=a)},null,512),[[C,t.tempCoupon.percent]]),eo])]),o("div",so,[o("div",no,[c(o("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=a=>t.tempCoupon.is_enabled=a)},null,512),[[P,t.tempCoupon.is_enabled]]),ao])])])])]),o("div",lo,[io,o("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=(...a)=>t.confirmCoupon&&t.confirmCoupon(...a))},"確認")])])])],512)}const po=M(T,[["render",uo]]),co={props:["tempCoupon"],data(){return{delModal:""}},methods:{confirmDel(){this.$emit("delCoupon")},delModalShow(){this.delModal.show()},delModalHide(){this.delModal.hide()}},mounted(){this.delModal=new D(this.$refs.delCouponModal)}},ro={id:"delCouponModal",ref:"delCouponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delCouponModalLabel","aria-hidden":"true"},mo={class:"modal-dialog"},ho={class:"modal-content border-0"},_o=o("div",{class:"modal-header bg-danger text-white"},[o("h5",{id:"delCouponModalLabel",class:"modal-title"},[o("span",null,"刪除優惠券")]),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),bo={class:"modal-body"},fo={class:"text-danger"},Co={class:"modal-footer"},go=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1);function $o(t,e,n,l,_,p){return d(),i("div",ro,[o("div",mo,[o("div",ho,[_o,o("div",bo,[v(" 是否刪除"),o("strong",fo,"【"+h(this.tempCoupon.title)+"】",1),v(" 商品(刪除後將無法恢復)。 ")]),o("div",Co,[go,o("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=(...a)=>p.confirmDel&&p.confirmDel(...a))},"確認刪除")])])])],512)}const Mo=M(co,[["render",$o]]),vo={computed:{...y(u,["pagination","coupons","loadingStatus","status","loadingIcon","tempCoupon"])},components:{LoadingOverlay:I,PaginationComponent:A,couponModal:po,DelCouponModal:Mo},methods:{...k(u,["getCoupon","openModal","enabled","confirmDel"])},mounted(){this.getCoupon(),Y(()=>{this.status==="new"||this.status==="edit"?(u().status="",this.$refs.couponModal.openModal()):this.status==="delete"?(u().status="",this.$refs.delCouponModal.delModalShow()):this.status==="closeModal"&&(u().status="",this.$refs.couponModal.closeModal(),this.$refs.delCouponModal.delModalHide())})}},yo={class:"container"},ko={class:"text-end mt-4"},Po={class:"table table-hover mt-4"},Do=o("thead",null,[o("tr",null,[o("th",null,"名稱"),o("th",null,"折扣百分比"),o("th",null,"到期日"),o("th",null,"優惠碼"),o("th",null,"啟用狀態"),o("th",null,"編輯")])],-1),wo={class:"form-check form-switch"},So=["id","onUpdate:modelValue","onChange","disabled"],Vo=["for"],Io={key:0},Ao={key:1},Eo={key:2,class:"fas fa-spinner fa-pulse ms-2"},Lo={class:"btn-group"},Yo=["onClick"],Uo=["onClick"];function No(t,e,n,l,_,p){const a=g("LoadingOverlay"),w=g("PaginationComponent"),S=g("couponModal"),V=g("DelCouponModal");return d(),i("div",yo,[$(a,{active:t.loadingStatus,"onUpdate:active":e[0]||(e[0]=s=>t.loadingStatus=s),"is-full-page":!0},null,8,["active"]),o("div",ko,[o("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=s=>t.openModal("new"))}," 建立新的優惠券 ")]),o("table",Po,[Do,o("tbody",null,[(d(!0),i(U,null,N(t.coupons,s=>(d(),i("tr",{key:s.id},[o("td",null,h(s.title),1),o("td",null,h(s.percent)+"%",1),o("td",null,h(t.$dayjs.unix(s.due_date).format("YYYY-MM-DD")),1),o("td",null,h(s.code),1),o("td",null,[o("div",wo,[c(o("input",{class:"form-check-input",type:"checkbox",role:"switch",id:`coupon${s.id}`,"onUpdate:modelValue":b=>s.is_enabled=b,"true-value":1,"false-value":0,onChange:b=>t.enabled(s),disabled:t.loadingIcon===s.id},null,40,So),[[P,s.is_enabled]]),o("label",{class:"form-check-label",for:`coupon${s.id}`},[s.is_enabled?(d(),i("span",Io,"已啟用")):(d(),i("span",Ao,"未啟用")),t.loadingIcon===s.id?(d(),i("i",Eo)):j("",!0)],8,Vo)])]),o("td",null,[o("div",Lo,[o("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:b=>t.openModal("edit",s)},"編輯",8,Yo),o("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:b=>t.openModal("delete",s)},"刪除",8,Uo)])])]))),128))])]),$(w,{nationComponent:"",pages:t.pagination,onEmitPages:t.getCoupon},null,8,["pages","onEmitPages"]),$(S,{ref:"couponModal"},null,512),$(V,{ref:"delCouponModal","temp-coupon":t.tempCoupon,onDelCoupon:t.confirmDel},null,8,["temp-coupon","onDelCoupon"])])}const Bo=M(vo,[["render",No]]);export{Bo as default};
